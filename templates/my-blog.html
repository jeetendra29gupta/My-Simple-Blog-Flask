{% extends "layout.html" %}

{% block title %} My Simple Blog | User Blog Page {% endblock %}

{% block body %}

{% include "navigation.html"%}
{% include "message.html" %}

<!-- POSTS SECTION -->
{% if posts.items|length > 0 %}
<div class="w3-container w3-section">
    <h2 class="w3-center w3-bold">Post</h2>


    <div class="w3-row-padding w3-section w3-stretch">
        <div class="w3-container w3-threequarter">
            <form class="w3-row-padding w3-stretch">
                <div class="w3-container w3-threequarter">
                    <input type="text" class="w3-input w3-border w3-round" placeholder="&#128270; Search..">
                </div>
                <div class="w3-container w3-quarter">
                    <a href="#" class="w3-button w3-green w3-round"> Search </a>
                </div>
            </form>
        </div>
        <div class="w3-container w3-quarter">
            <a href="{{ url_for('main.create_blog') }}"
               class="w3-button w3-ripple w3-block w3-round w3-blue-gray">
                Add Blogs
            </a>
        </div>
    </div>


    <table class="w3-table-all w3-hoverable">
        <thead>
        <tr class="w3-green">
            <th>Title</th>
            <th>Created At</th>
            <th>Updated At</th>
            <th>Actions</th>
        </tr>
        </thead>
        {% for post in posts.items %}
        <tr>
            <td>{{ post.title }}</td>

            <td>{{ post.created_at.strftime('%Y-%m-%d %H:%M') }}</td>
            <td>{{ post.updated_at.strftime('%Y-%m-%d %H:%M') }}</td>

            <td class="action-btns">

                <!-- View -->
                <a href="{{ url_for('main.view_blog', bid=post.id) }}"
                   class="w3-button w3-ripple w3-blue w3-round w3-bold">View</a>

                <!-- Edit -->
                <a href="{{ url_for('main.edit_blog', bid=post.id) }}"
                   class="w3-button w3-ripple w3-teal w3-round w3-bold">Edit</a>

                <!-- Delete -->
                <a href="{{ url_for('main.delete_blog', bid=post.id) }}"
                   class="w3-button w3-ripple w3-red w3-round w3-bold"
                   onclick="return confirm('Are you sure you want to delete this post?');">
                    Delete
                </a>

                <!-- Publish / UnPublish / Draft Toggle -->
                {% if post.status.value in ["draft", "unpublished"] %}
                <a href="{{ url_for('main.toggle_status', bid=post.id) }}"
                   class="w3-button w3-ripple w3-green w3-round w3-bold">
                    Published
                </a>
                {% else %}
                <a href="{{ url_for('main.toggle_status', bid=post.id) }}"
                   class="w3-button w3-ripple w3-orange w3-round w3-bold">
                    Unpublished
                </a>
                {% endif %}

            </td>
        </tr>
        {% endfor %}
        <tbody>
        </tbody>
    </table>

</div>

{% else %}
<div class="w3-panel w3-leftbar w3-rightbar w3-sand w3-xxlarge w3-serif w3-card w3-round w3-center"
     style="width: 60%; margin: auto;">
    <p>No posts yet. Create one!</p>
</div>
<div class="w3-container w3-center">
    <a href="{{ url_for('main.create_blog') }}"
       class="w3-button w3-ripple w3-section w3-round w3-blue-gray">
        Add Blogs
    </a>
</div>

{% endif %}

<!-- PAGINATION -->
<div class="w3-center">
    <div class="w3-bar">
        {% if posts.has_prev %}
        <a href="{{ url_for('main.blog', page=posts.prev_num) }}" class="w3-button w3-round">&laquo;</a>
        {% endif %}

        {% for p in posts.iter_pages(left_edge=1, right_edge=1, left_current=2, right_current=2) %}
        {% if p %}
        {% if p == posts.page %}
        <a href="{{ url_for('main.blog', page=p) }}" class="w3-button w3-green w3-round">{{ p }}</a>
        {% else %}
        <a href="{{ url_for('main.blog', page=p) }}" class="w3-button w3-round">{{ p }}</a>
        {% endif %}
        {% else %}
        ...
        {% endif %}
        {% endfor %}

        {% if posts.has_next %}
        <a href="{{ url_for('main.blog', page=posts.next_num) }}" class="w3-button w3-round">&raquo;</a>
        {% endif %}
    </div>
</div>

{% endblock %}